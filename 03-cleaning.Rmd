# Data Cleaning

```{r, include = FALSE}
library(tidyverse)
library(dplyr)
```

```{r}
# Abbreviate character values in the dataset 
abbreviate <- function(ds, total = FALSE, race = FALSE){
    if (!race){
        ds$Education[which(ds$Education == "Less.than.high.school.graduate")] <- "Less Than High School"
        ds$Education[which(ds$Education == "High.school.graduate..includes.equivalency.")] <- "High School Graduate"
        ds$Education[which(ds$Education == "Some.college.or.associate.s.degree")] <- "Some Colleges"
        ds$Education[which(ds$Education == "Bachelor.s.degree")] <- "Bachelor Degree"
        ds$Education[which(ds$Education == "Graduate.or.professional.degree")] <- "Advanced Degree"
    }
    
    if (race){
        ds$Education[which(ds$Education == "High.school.graduate.or.higher")] <- "High School or Higher"
        ds$Education[which(ds$Education == "Bachelor.s.degree.or.higher")] <- "Bachelor Degree or Higher"
        ds$Race[which(ds$Race == "White.alone..not.Hispanic.or.Latino" | ds$Race == "White.alone.not.Hispanic.or.Latino")] <- "White Alone"
        ds$Race[which(ds$Race == "Hispanic.or.Latino.Origin")] <- "Hispanic or Latino Origin"
        ds$Race[which(ds$Race == "Black.alone")] <- "Black Alone"
        ds$Race[which(ds$Race == "Asian.alone")] <- "Asian Alone"
        ds$Race<- as.factor(ds$Race)
        ds$Race<-fct_relevel(ds$Race,"White Alone","Hispanic or Latino Origin","Black Alone", "Asian Alone","Other")

    }
    ds$Education <- as.factor(ds$Education)
    if(total){
      ds$Education <- fct_relevel(ds$Education,"Less Than High School","High School Graduate","Some Colleges","Bachelor Degree", "Advanced Degree","Total")
    }
    if(!total&&!race){
      ds$Education<-fct_relevel(ds$Education,"Less Than High School","High School Graduate","Some Colleges","Bachelor Degree", "Advanced Degree")

    }
    if(race){
      ds$Education<-fct_relevel(ds$Education,"Total","High School or Higher",">= Bachelor Degree or Higher")
    }
    return(ds)
}
```

```{r}
states <- read.csv("./data/states.csv", na.strings = "N/A")

#extract columns for education attainment
states_education <- states[,1:7]
states_education <- states_education %>% pivot_longer(cols =!State ,names_to = "Education",values_to = "Population")

#extract columns for median earning
states_earning <- states[,c(1,8,9,10,11,12,13)]
states_earning <- states_earning %>% pivot_longer(cols =!State ,names_to = "Education",values_to = "Earning")

#combine data
states <- cbind(states_education,states_earning[,3])
states <- abbreviate(states,total = TRUE)
```


```{r}
states
```

```{r}
birth <- read.csv("./data/births.csv", na.strings = "N/A")

birth <- birth %>% pivot_longer(cols =1:20 ,names_to = c("Give_birth","Marriage","Education"),
    names_sep = "_",
    values_to = "Estimate")
# Make character values more descriptive and succinct as possible
# Need a note about the inclusion of each group specifically: 
# For example, high school = high school (including equivalency), advanced degree = graduate or professional degree
birth <- abbreviate(birth)
```

```{r}
birth
```

```{r}
# Function of combining some races into 'Other Races' category
combine_races <- function(race, combine_list){
    race[race$Race %in% combine_list, "Race"] <- "Other"
    combine_race <- race %>% 
        filter(Race == "Other") %>% 
        group_by(Gender, Education) %>% 
        summarise(Estimate = sum(Estimate), .groups = "drop") %>% 
        mutate(Race = "Other")
    race <- race[!race$Race == "Other", ]
    race <- rbind(race, combine_race)
    return(race)
}
```


```{r}
race <- read.csv("./data/race.csv", na.strings = "N/A")
race<- race %>% pivot_longer(cols = !Gender ,names_to = c("Race","Education"),
    names_sep = "_",
    values_to = "Estimate")

other_race_list = list("Native.Hawaiian.and.Other.Pacific.Islander.alone", "American.Indian.or.Alaska.Native.alone", "Some.other.race.alone", "Two.or.more.races")
race <- combine_races(race, other_race_list)

# Make character values more descriptive and succinct as possible
# Need a note that: white means white alone does not count Hispanic or Latino
# Other races include: xxx
race <- abbreviate(race, race = TRUE,)

```

```{r}
race
```


```{r}
education <- read.csv("./data/2015-2019Education.csv", na.strings = "N/A")
education<-education %>% pivot_longer(cols = !Gender ,names_to = c("Year","Education"),
    names_sep = "_",
    values_to = "Estimate")
education$Year <- as.integer(gsub("X", "", education$Year))

# Make character values more descriptive and succinct as possible
education <- abbreviate(education)
```

```{r}
education
```


```{r}
earning <- read.csv("./data/2015-2019earnings.csv", na.strings = "N/A")
earning<-earning %>% pivot_longer(cols = !Gender ,names_to = c("Year","Education"),
    names_sep = "_",
    values_to = "Earning")
earning$Year <- as.integer(gsub("X", "", earning$Year))
earning <- abbreviate(earning,total=TRUE)


```

```{r}
earning
```

